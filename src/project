day_num = 0
import csv
import random

def main():
    #this is the main game loop, yes?
    #so maybe it would start with a function like run_intro.
    #I should put an extra function to run on day 1, basically to play the intro and take care of setting names and stuff
    if day_num == 0:
        player_name, filename, player_dict, birch_dict, marlowe_dict, pixie_dict, stellaluna_dict, elwood_dict, companion_list, inventory_dict = initialize()
    run_intro(companion_list, birch_dict, marlowe_dict, pixie_dict, stellaluna_dict, elwood_dict, inventory_dict)
    #for the sake of clarity, I think run_intro should only take care of the new day and status report messages.
    #the camp choices can go to another function.
    run_camp(companion_list, inventory_dict)

def initialize():
    #add some fancy stuff here later. Print title and intro story.
    #allow player to pick name
    player_name=input("What is your name? ")
    filename=f"{player_name}.csv"
    print(f"Welcome to Cat's Cradle Coven, {player_name}! Are you ready to start on a new adventure?\n")
    print("But before you start your coven, we need to know what sort of leader you'll be.\n")
    #notes: this appears sloppy in the terminal. fix this text later.
    print("Some cats excel at the art of the hunt, while others have an excellent intuition for dealing with herbs. "
            "Do you disperse enemies through shows of strength, or charm them with a silver tongue? "
            "The possibilities are endless.\n")
    skill_unpicked=True
    while skill_unpicked==True:
        player_type=input("What skill do you specialize in? Please type the number of your choice - 1.Hunting 2.Gathering 3.Strength 4.Charm ")
        if player_type == "1":
            hunt = 5
            herb = 2
            fight = 2
            talk = 2
            skill_unpicked=False
        elif player_type == "2":
            hunt = 2
            herb = 5
            fight = 2
            talk = 2
            skill_unpicked=False
        elif player_type == "3":
            hunt = 2
            herb = 2
            fight = 5
            talk = 2
            skill_unpicked=False
        elif player_type == "4":
            hunt = 2
            herb = 2
            fight = 2
            talk = 5
            skill_unpicked=False
        else:
            print("Sorry, that was not a valid response. Please type 1, 2, 3, or 4.")
            continue
    #create a csv file that will act as a save point using the player's name as a naming convention.
    #if there is already a file, load that instead.
    #Add the player's name and their starter stats, then first companion's name/stats
    with open(filename, 'w', newline='') as file:
        csv_writer=csv.writer(file)
        csv_writer.writerow(["Name", "Hunting", "Gathering", "Strength", "Charm", "Health", "Friendship"])
        csv_writer.writerow([player_name, hunt, herb, fight, talk, "5", "1"])
        csv_writer.writerow(["Birch", "4", "1", "3", "3", "5", "1"])

    #then make a dictionary for player and Birch, for easy access
    player_dict = {
        "Name": player_name,
        "Hunting": hunt,
        "Gathering": herb,
        "Strength": fight,
        "Charm": talk,
        "Health": 5
    }
    birch_dict = {
        "Name": "Birch",
        "Hunting": 4,
        "Gathering": 1,
        "Strength": 3,
        "Charm": 3,
        "Health": 5,
        "Friendship": 1
    }
    #gonna make dicts for the other cats too, for later use
    marlowe_dict = {
        "Name": "Marlowe",
        "Hunting": 6,
        "Gathering": 11,
        "Strength": 6,
        "Charm": 2,
        "Health": 10,
        "Friendship": 1
    }
    pixie_dict = {
        "Name": "Pixie",
        "Hunting": 7,
        "Gathering": 4,
        "Strength": 7,
        "Charm": 19,
        "Health": 15,
        "Friendship": 1
    }
    stellaluna_dict = {
        "Name": "Stella-Luna",
        "Hunting": 6,
        "Gathering": 7,
        "Strength": 27,
        "Charm": 7,
        "Health": 20,
        "Friendship": 1
    }
    elwood_dict = {
        "Name": "Elwood",
        "Hunting": 40,
        "Gathering": 40,
        "Strength": 40,
        "Charm": 40,
        "Health": 30,
        "Friendship": 1
    }
    inventory_dict = {
        "Herbs": 0,
        "Food": 0
    }

    companion_list = [birch_dict]

    return player_name, filename, player_dict, birch_dict, marlowe_dict, pixie_dict, stellaluna_dict, elwood_dict, companion_list, inventory_dict
       

def run_intro(companion_list, birch_dict, marlowe_dict, pixie_dict, stellaluna_dict, elwood_dict, inventory_dict):
    #this runs the status report at the beginning of every day.
    print("It's a new day!")
    print("Status Report:")
    #for each cat in companion_list:
    #if is_injured = True:
    #print("{cat_name} is injured!")
    #else:
    #print("{cat_name} is ready to go!")
    herb = inventory_dict.get("Herbs")
    food = inventory_dict.get("Food")
    print(f"You have {herb} herbs and {food} food.\n")
    for cat in companion_list:
        cat_name = cat.get("Name")
        if cat.get("Health") <=0:
            print(f"{cat_name} is injured!\n")
        else:
            print(f"{cat_name} is ready to go!\n")

def run_camp(companion_list, inventory_dict):
    #this covers the player input. It should ask them if they want to send someone exploring, cast a spell, or talk to their companions.
    #also mb I should add a debug function for easy testing?
    has_explored = False
    has_cast_spell = False
    has_talked = False
    while True:
        print("Do you want to:")
        print("1. Explore   2. Cast a spell   3. Talk to someone   4. End the day")
        choice = input("Type the number of your choice:")
        if choice == '1':
            if has_explored == True:
                print("You've already sent someone out to explore today!")
            else:
                has_explored = send_exploring(companion_list, inventory_dict)
        elif choice == '2':
            if has_cast_spell == True:
                print("You can't cast two spells on the same day.")
            else:
                has_cast_spell = cast_spell(companion_list, inventory_dict)
        elif choice == '3':
            if has_talked == True:
                print("Your coven is busy...")
            else:
                #add talking stuff here
                pass
        elif choice == '4':
            #mb put the random event here?
            pick_random_event(companion_list, inventory_dict)
            run_intro(companion_list, inventory_dict)
        elif choice == 'debug':
            open_debug_menu(companion_list, inventory_dict)

def send_exploring(companion_list, inventory_dict):
    exploring_list = []
    exploring = True
    while exploring == True:
        print("Who do you want to send out? The available cats are:")
        for cat in companion_list:
            cat_name = cat.get("Name")
            if cat.get("Health") > 0:
                print (f"{cat_name}")
                exploring_list.append(cat_name)
            else:
                pass
        explore_companion = input("Type the name of the cat you want to send, or type r to return. ")
        if explore_companion in exploring_list:
            food_gained, herb_gained = calculate_explore(explore_companion, companion_list)
            print(f"{explore_companion} obtained {food_gained} food and {herb_gained} herbs!\n")
            inventory_dict["Food"] = (inventory_dict.get("Food") + food_gained)
            inventory_dict["Herbs"] = (inventory_dict.get("Herbs") + herb_gained)
            exploring = False
            return True
        elif explore_companion == "r":
            exploring = False
            return False
        else:
            print()

def calculate_explore(explore_companion, companion_list):
    if explore_companion == 'Birch':
        explore_dict = companion_list[0]
    companion_hunt = explore_dict.get("Hunting")
    companion_gather = explore_dict.get("Gathering")
    explore_dict["Health"] = (explore_dict.get("Health") - 1)

    hunt_rng = random.randrange(0, 51)
    hunt_num = min(hunt_rng+companion_hunt, 60)
    if 0 <= hunt_num <= 10:
        food_caught = 1
    elif 11<= hunt_num <= 20:
        food_caught = 2
    elif 21<= hunt_num <= 30:
        food_caught = 4
    elif 31<= hunt_num <= 40:
        food_caught = 6
    elif 41<= hunt_num <= 50:
        food_caught = 9
    elif 51<= hunt_num <= 60:
        food_caught = 12

    herb_rng = random.randrange(0, 51)
    herb_num = min(herb_rng+companion_gather, 60)
    if 0 <= herb_num <= 10:
        herb_gathered = 1
    elif 11<= herb_num <= 20:
        herb_gathered = 2
    elif 21<= herb_num <= 30:
        herb_gathered = 4
    elif 31<= herb_num <= 40:
        herb_gathered = 6
    elif 41<= herb_num <= 50:
        herb_gathered = 9
    elif 51<= herb_num <= 60:
        herb_gathered = 12
    
    return food_caught, herb_gathered

def cast_spell(companion_list, inventory_dict):
    casting = True
    while casting == True:
        print("What sort of spell would you like to cast today? 1. Health | 2. Hunting | 3. Gathering | 4. Charm | 5. Strength ")
        spell_type = input("Please type the number of your choice, or r to return.")
        if spell_type == "r":
            casting == False
            return False
        if spell_type == '1':
            print("Healing spells recover your companions' hit points!")
            print("Which healing spell would you like to cast?\n")
            print("1. Basic healing spell | Cost: 3 Herbs\n")
            print("2. Intermediate healing spell | Cost: 5 Herbs\n")
            print("3. Advanced healing spell | Cost: 10 Herbs\n")
            healing_type = input("Please type the number of your choice, or r to return.")
            if healing_type == 'r':
                pass
            elif healing_type == '1':
                if inventory_dict.get("Herbs") < 3:
                    print("You don't have enough herbs to cast that spell!\n")
                else:
                    spell_target, target_dict = pick_spell_target(companion_list)
                    target_dict["Health"] = (target_dict.get("Health") + 2)
                    print(f"{spell_target} has gained 2 health!")
                    return True
            elif healing_type == '2':
                if inventory_dict.get("Herbs") < 5:
                    print("You don't have enough herbs to cast that spell!\n")
                else:
                    spell_target, target_dict = pick_spell_target(companion_list)
                    target_dict["Health"] = (target_dict.get("Health") + 4)
                    print(f"{spell_target} has gained 4 health!")
                    return True
            elif healing_type == '3':
                if inventory_dict.get("Herbs") < 10:
                    print("You don't have enough herbs to cast that spell!\n")
                else:
                    spell_target, target_dict = pick_spell_target(companion_list)
                    target_dict["Health"] = (target_dict.get("Health") + 8)
                    print(f"{spell_target} has gained 8 health!")
                    return True
        elif spell_type == '2':
            print("Hunting spells enhance your companions' abilities so they can catch more prey!")
            print("Which hunting spell would you like to cast?\n")
            print("1. Swift Paws | Cost: 5 Herbs\n")
            print("2. Bird's Eye View | Cost: 8 Herbs\n")
            print("3. Cloak of Shadows | Cost: 12 Herbs")
            hunting_type = input("Please type the number of your choice, or r to return.")
            if hunting_type == 'r':
                pass
            elif hunting_type == '1':
                if inventory_dict.get("Herbs") < 5:
                    print("You don't have enough herbs to cast that spell!\n")
                else:
                    spell_target, target_dict = pick_spell_target(companion_list)
                    target_dict["Hunting"] = (target_dict.get("Hunting") + 1)
                    print(f"{spell_target} has gained 1 Hunting skill!")
                    return True
            elif hunting_type == '2':
                if inventory_dict.get("Herbs") < 8:
                    print("You don't have enough herbs to cast that spell!\n")
                else:
                    spell_target, target_dict = pick_spell_target(companion_list)
                    target_dict["Hunting"] = (target_dict.get("Hunting") + 4)
                    print(f"{spell_target} has gained 4 Hunting skill!")
                    return True
            elif hunting_type == '3':
                if inventory_dict.get("Herbs") < 12:
                    print("You don't have enough herbs to cast that spell!\n")
                else:
                    spell_target, target_dict = pick_spell_target(companion_list)
                    target_dict["Hunting"] = (target_dict.get("Hunting") + 6)
                    print(f"{spell_target} has gained 6 Hunting skill!")
                    return True
        elif spell_type == '3':
            print("Gathering spells grant your companions better knoweldge of nature, so they naturally find more herbs.")
            print ("Which gathering spell would you like to cast?\n")
            print("1. Gatherer's Intuition | Cost: 7 Herbs\n")
            print("2. Nature Knack | Cost: 12 Herbs\n")
            print("3. Terra's Guidance | Cost: 15 Herbs\n")
            gathering_type = input("Please type the number of your choice, or r to return.")
            if gathering_type == 'r':
                pass
            elif gathering_type == '1':
                if inventory_dict.get("Herbs") < 7:
                    print("You don't have enough herbs to cast that spell!\n")
                else:
                    spell_target, target_dict = pick_spell_target(companion_list)
                    target_dict["Gathering"] = (target_dict.get("Gathering") + 1)
                    print(f"{spell_target} has gained 1 Gathering skill!")
                    return True
            elif gathering_type == '2':
                if inventory_dict.get("Herbs") < 12:
                    print("You don't have enough herbs to cast that spell!\n")
                else:
                    spell_target, target_dict = pick_spell_target(companion_list)
                    target_dict["Gathering"] = (target_dict.get("Gathering") + 4)
                    print(f"{spell_target} has gained 4 Gathering skill!")
                    return True
            elif gathering_type == '3':
                if inventory_dict.get("Herbs") < 15:
                    print("You don't have enough herbs to cast that spell!\n")
                else:
                    spell_target, target_dict = pick_spell_target(companion_list)
                    target_dict["Gathering"] = (target_dict.get("Gathering") + 6)
                    print(f"{spell_target} has gained 6 Gathering skill!")
                    return True
        elif spell_type == '4':
            print("Charm spells grant your companions the gift of gab, useful for making allies in the forest!")
            print("Which charm spell would you like to cast?\n")
            print("1. Shiny Fur | Cost: 10 Herbs\n")
            print("2. Silver Tongue | Cost: 14 Herbs\n")
            print("3. Aura of Benevolence | Cost: 18 Herbs")
            charm_type = input("Please type the number of your choice, or r to return.")
            if charm_type == 'r':
                pass
            elif charm_type == '1':
                if inventory_dict.get("Herbs") < 10:
                    print("You don't have enough herbs to cast that spell!\n")
                else:
                    spell_target, target_dict = pick_spell_target(companion_list)
                    target_dict["Charm"] = (target_dict.get("Charm") + 1)
                    print(f"{spell_target} has gained 1 Charm skill!")
                    return True
            elif charm_type == '2':
                if inventory_dict.get("Herbs") < 14:
                    print("You don't have enough herbs to cast that spell!\n")
                else:
                    spell_target, target_dict = pick_spell_target(companion_list)
                    target_dict["Charm"] = (target_dict.get("Charm") + 4)
                    print(f"{spell_target} has gained 4 Charm skill!")
                    return True
            elif charm_type == '3':
                if inventory_dict.get("Herbs") < 18:
                    print("You don't have enough herbs to cast that spell!\n")
                else:
                    spell_target, target_dict = pick_spell_target(companion_list)
                    target_dict["Charm"] = (target_dict.get("Charm") + 6)
                    print(f"{spell_target} has gained 6 Charm skill!")
                    return True
        elif spell_type == '5':
            print("Strength spells allow your companions to deepen their power so they can do more with their magic!")
            print("Which strength spell would you like to cast?\n")
            print("1. Inner Spark | Cost: 17 Herbs\n")
            print("2. Potent Flame | Cost: 21 Herbs\n")
            print("3. Inferno Soul | Cost: 25 Herbs")
            strength_type = input("Please type the number of your choice, or r to return.")
            if strength_type == 'r':
                pass
            elif strength_type == '1':
                if inventory_dict.get("Herbs") < 10:
                    print("You don't have enough herbs to cast that spell!\n")
                else:
                    spell_target, target_dict = pick_spell_target(companion_list)
                    target_dict["Strength"] = (target_dict.get("Strength") + 1)
                    print(f"{spell_target} has gained 1 Strength skill!")
                    return True
            elif strength_type == '2':
                if inventory_dict.get("Herbs") < 14:
                    print("You don't have enough herbs to cast that spell!\n")
                else:
                    spell_target, target_dict = pick_spell_target(companion_list)
                    target_dict["Strength"] = (target_dict.get("Strength") + 4)
                    print(f"{spell_target} has gained 4 Strength skill!")
                    return True
            elif strength_type == '3':
                if inventory_dict.get("Herbs") < 18:
                    print("You don't have enough herbs to cast that spell!\n")
                else:
                    spell_target, target_dict = pick_spell_target(companion_list)
                    target_dict["Strength"] = (target_dict.get("Strength") + 6)
                    print(f"{spell_target} has gained 6 Strength skill!")
                    return True
                    
def pick_spell_target(companion_list):
    casting_list = []
    print("Who do you want to cast this spell on? Available recipients are:\n")
    for cat in companion_list:
        cat_name = cat.get("Name")
        cat_health = cat.get("Health")
        print (f"{cat_name} - Health: {cat_health}\n")
        casting_list.append(cat_name)
    spell_target = input("Please type the name of your choice. ")
    if spell_target in casting_list:
        if spell_target == 'Birch':
            target_dict = companion_list[0]
        elif spell_target == 'Marlowe':
            target_dict = companion_list[1]
        elif spell_target == 'Pixie':
            target_dict = companion_list[2]
        elif spell_target == 'Stellaluna':
            target_dict = companion_list[3]
        elif spell_target == 'Elwood':
            target_dict = companion_list[4]
        return spell_target, target_dict
    else:
        print("Sorry, that's not a valid input. Please type another answer.")

def pick_random_event(companion_list, inventory_dict):
    #range max = 1+ the number of items on companion list times ten.
    pass

def open_debug_menu(companion_list, inventory_dict):
    debug = True
    while debug == True:
        debug_command = input("Please input your command or r to return. ")
        if debug_command == "food":
            inventory_dict["Food"] = 100
        elif debug_command == "herb":
            inventory_dict["Herbs"] = 100
        elif debug_command == 'r':
            debug = False
            return
            

        

if __name__ == "__main__":
    main()